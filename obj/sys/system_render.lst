ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .include "sys/system_render.h.s"
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              1 .include "main.h.s"
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                              1 .include "data.h.s"
                              1 ;;MAPS
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              2 .include "bins/map_00.h.s"
                              1 ;; File 'src/bins/map_00.h.s' generated using cpct_pack
                              2 ;; Compresor used:   zx7b
                              3 ;; Files compressed: [ 'src/maps/Mapa_00.bin' ]
                              4 ;; Uncompressed:     460 bytes
                              5 ;; Compressed:       120 bytes
                              6 ;; Space saved:      340 bytes
                              7 ;;
                              8 
                              9 ;; Declaration of the compressed array and
                             10 ;; the address of the latest byte of the compressed array (for unpacking purposes)
                             11 .globl _map_00
                             12 .globl _map_00_end
                             13 
                             14 ;; Compressed and uncompressed sizes
                     0078    15 _map_00_size_z == 120
                     01CC    16 _map_00_size   == 460
                             17 
                             18 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



                              3 
                              4 .globl level_index
                              5 
                              6 .globl palette_index
                              7 
                              8 
                              9 ;HUD COSAS
                             10 ;                         ptr
                     A807    11 HUD_P1_DEATHS   = 0xA807
                     A847    12 HUD_P2_DEATHS   = 0xA847
                             13 
                     A80E    14 HUD_P1_SCORE    = 0xA80E
                     A83B    15 HUD_P2_SCORE    = 0xA83B
                             16 
                     A024    17 HUD_SKULL_1     = 0xA024
                     A027    18 HUD_SKULL_2     = 0xA027
                     A02A    19 HUD_SKULL_3     = 0xA02A
                             20 
                             21 
                             22 
                     0002    23 NUM_LEVELS = 2
                             24 
                             25 ;;SPRITES
                             26 .globl _checkpoint_top_spr_0
                             27 .globl _checkpoint_top_spr_1
                             28 
                             29 .globl _player_spr_00
                             30 .globl _player_spr_01
                             31 .globl _player_spr_04
                             32 .globl _player_spr_05
                             33 .globl _player_spr_08
                             34 .globl _player_spr_09
                             35 .globl _player_spr_12
                             36 .globl _player_spr_13
                             37 .globl _player_spr_14
                             38 .globl _player_spr_15
                             39 .globl _player_spr_16
                             40 .globl _player_spr_17
                             41 
                             42 .globl _player_2_spr_00
                             43 .globl _player_2_spr_13
                             44 .globl _player_2_spr_14
                             45 .globl _player_2_spr_15
                             46 .globl _player_2_spr_16
                             47 .globl _player_2_spr_17 
                             48 
                             49 .globl _enemy_spr_00
                             50 .globl _enemy_spr_04
                             51 .globl _enemy_spr_08
                             52 .globl _enemy_spr_12
                             53 .globl _enemy_spr_16
                             54 .globl _enemy_spr_20
                             55 
                             56 .globl _door_spr_0
                             57 .globl _door_spr_1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]



                             58 .globl _door_spr_2
                             59 .globl _door_spr_3
                             60 .globl _door_spr_4
                             61 
                             62 .globl _hud_spr_15
                             63 .globl _hud_spr_14
                             64 .globl _hud_spr_13
                             65 .globl _hud_spr_12
                             66 .globl _hud_spr_11
                             67 .globl _hud_spr_10
                             68 .globl _hud_spr_09
                             69 .globl _hud_spr_08
                             70 .globl _hud_spr_07
                             71 .globl _hud_spr_06
                             72 .globl _hud_spr_05
                             73 .globl _hud_spr_04
                             74 .globl _hud_spr_03
                             75 .globl _hud_spr_02
                             76 .globl _hud_spr_01
                             77 .globl _hud_spr_00
                             78 
                             79 .globl _hud_skull_spr_2
                             80 .globl _hud_skull_spr_1
                             81 .globl _hud_skull_spr_0
                             82 
                             83 .globl _letter_spr_27
                             84 .globl _letter_spr_26
                             85 .globl _letter_spr_25
                             86 .globl _letter_spr_24
                             87 .globl _letter_spr_23
                             88 .globl _letter_spr_22
                             89 .globl _letter_spr_21
                             90 .globl _letter_spr_20
                             91 .globl _letter_spr_19
                             92 .globl _letter_spr_18
                             93 .globl _letter_spr_17
                             94 .globl _letter_spr_16
                             95 .globl _letter_spr_15
                             96 .globl _letter_spr_14
                             97 .globl _letter_spr_13
                             98 .globl _letter_spr_12
                             99 .globl _letter_spr_11
                            100 .globl _letter_spr_10
                            101 .globl _letter_spr_09
                            102 .globl _letter_spr_08
                            103 .globl _letter_spr_07
                            104 .globl _letter_spr_06
                            105 .globl _letter_spr_05
                            106 .globl _letter_spr_04
                            107 .globl _letter_spr_03
                            108 .globl _letter_spr_02
                            109 .globl _letter_spr_01
                            110 .globl _letter_spr_00
                            111 
                            112 .globl _offon_spr_2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]



                            113 .globl _offon_spr_1
                            114 .globl _offon_spr_0
                            115 
                            116 .globl _dospuntos_spr
                            117 
                            118 .globl _double_jump_spr_0
                            119 .globl _double_jump_spr_1
                            120 .globl _double_jump_spr_2
                            121 .globl _double_jump_spr_3
                            122 .globl _double_jump_spr_4
                            123 
                            124 .globl _gravity_spr_13
                            125 .globl _gravity_spr_12
                            126 .globl _gravity_spr_11
                            127 .globl _gravity_spr_10
                            128 .globl _gravity_spr_09
                            129 .globl _gravity_spr_08
                            130 .globl _gravity_spr_07
                            131 .globl _gravity_spr_06
                            132 .globl _gravity_spr_05
                            133 .globl _gravity_spr_04
                            134 .globl _gravity_spr_03
                            135 .globl _gravity_spr_02
                            136 .globl _gravity_spr_01
                            137 .globl _gravity_spr_00
                            138 
                            139 .globl _colectable_spr_3
                            140 .globl _colectable_spr_2
                            141 .globl _colectable_spr_1
                            142 .globl _colectable_spr_0
                            143 .globl _colectable_void_spr
                            144 
                            145 .globl _hud_number_index
                            146 .globl _hud_letter_index
                            147 
                            148 ;;TEXTOS
                            149 .globl mm_singleplayer
                            150 .globl mm_multiplayer
                            151 .globl mm_options
                            152 
                            153 .globl om_controls
                            154 .globl om_p1controls
                            155 .globl om_p2controls
                            156 .globl om_accessibility
                            157 .globl om_godmode
                            158 .globl om_palette
                            159 .globl om_restore
                            160 .globl om_back
                            161 .globl om_changecontrols
                            162 .globl om_rightkey
                            163 .globl om_leftkey
                            164 .globl om_jumpkey
                            165 .globl om_off
                            166 .globl om_on
                            167 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 8.
Hexadecimal [16-Bits]



                            168 .globl pm_pause
                            169 .globl pm_return
                            170 .globl pm_mainmenu
                            171 
                            172 .globl em_completed
                            173 .globl em_score
                            174 .globl em_deaths
                            175 .globl em_p1
                            176 .globl em_p2
                            177 .globl em_time
                            178 .globl em_key
                            179 .globl em_no_p2_score
                            180 .globl em_no_p2_deaths
                            181 
                            182 
                            183 ;;                       Y        X
                     0C30   184 MM_SINGLEPLAYER_POS = 0x0C10 + 0x0020
                     0CD0   185 MM_MULTIPLAYER_POS  = 0x0CB0 + 0x0020
                     0D70   186 MM_OPTIONS_POS      = 0x0D50 + 0x0020
                            187 
                            188 ;;                          Y        X
                     0AE8   189 OM_CONTROLS_POS        = 0x0AD0 + 0x0018
                     0B84   190 OM_P1CONTROLS_POS      = 0x0B70 + 0x0014
                     0C24   191 OM_P2CONTROLS_POS      = 0x0C10 + 0x0014
                     0AFD   192 OM_ACCESSIBILITY_POS    = 0x0AD0 + 0x002E - 1
                     0B9C   193 OM_GODMODE_POS          = 0x0B70 + 0x002C
                     0C3C   194 OM_PALETTE_POS          = 0x0C10 + 0x002C
                     0D70   195 OM_RESTORE_POS          = 0x0D50 + 0x0020
                     0EB4   196 OM_BACK_POS             = 0x0E90 + 0x0024
                     0BA9   197 OM_OFF_POS              = 0x0B70 + 0x002C + 13
                     0BA9   198 OM_ON_POS               = 0x0B70 + 0x002C + 13
                            199 
                     0B89   200 OM_CHANGECONTROLS_POS   = 0x0B70 + 0x0026 - 13
                     0C34   201 OM_RIGHTKEY_POS         = 0x0C10 + 0x002D - 9
                     0C34   202 OM_LEFTKEY_POS          = 0x0C10 + 0x002D - 9
                     0C34   203 OM_JUMPKEY_POS          = 0x0C10 + 0x002D - 9
                            204 
                            205 ;;                   Y        X
                     0B94   206 PM_PAUSE_POS    = 0x0B70 + 0x0026 - 2
                     0C2B   207 PM_RETURN_POS   = 0x0C10 + 0x001C - 1
                     0C3D   208 PM_MAINMENU_POS = 0x0C10 + 0x002D
                            209 
                            210 
                     1298   211 EM_COMPLETED    = 0x1280 + 24
                     13E1   212 EM_SCORE        = 0x13C0 + 33
                     13EA   213 EM_DEATHS       = 0x13C0 + 42
                     147C   214 EM_P1           = 0x1460 + 28
                     151C   215 EM_P2           = 0x1500 + 28
                     1612   216 EM_TIME         = 0x15F0 + 34
                     174B   217 EM_CONTINUE     = 0x1730 + 27
                            218 
                     1480   219 EM_P1_SCORE_DCM = 0x1460 + 32
                     1482   220 EM_P1_SCORE_MC  = EM_P1_SCORE_DCM + 2
                     1484   221 EM_P1_SCORE_DU  = EM_P1_SCORE_MC + 2
                            222 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 9.
Hexadecimal [16-Bits]



                     148B   223 EM_P1_DEATHS_MC = 0x1460 + 43
                     148D   224 EM_P1_DEATHS_DU = EM_P1_DEATHS_MC + 2
                            225 
                     1520   226 EM_P2_SCORE_DCM = 0x1500 + 32
                     1522   227 EM_P2_SCORE_MC  = EM_P2_SCORE_DCM + 2
                     1524   228 EM_P2_SCORE_DU  = EM_P2_SCORE_MC + 2
                            229 
                     152B   230 EM_P2_DEATHS_MC    = 0x1500 + 43
                     152D   231 EM_P2_DEATHS_DU = EM_P2_DEATHS_MC + 2
                            232 
                     1664   233 EM_TOTAL_TIME   = 0x1640 + 36
                            234 
                            235 
                     0320   236 SUBMENU_BOX_1_POS       = 0x0320
                     0360   237 SUBMENU_BOX_2_POS       = 0x0320 + 0x0040
                     1B20   238 SUBMENU_BOX_LINE_TOP    = 0x1B20
                     2460   239 SUBMENU_BOX_LINE_BOTTOM = 0x2460
                            240 
                            241 
                     283B   242 HUD_SCORE_POS = 0x2800 + 59
                     2847   243 HUD_DEATH_POS = 0x2800 + 71
                            244 
                            245 
                            246 ;;STRING CONSTS
                     002F   247 END_STRING = 47
                     003D   248 START_CHARACTERS = 61
                     0030   249 START_NUMBERS = 48
                            250 
                            251 
                            252 
                            253 ;;SPRITE SIZE
                     0030   254 SPR_PLAYER_SIZE = 2 * 3 * 8
                     0004   255 SPR_CHECKPOINT_SIZE = 1 * 4
                     001A   256 SPR_COLLECTABLE_SIZE = 2 * 13
                     0016   257 SPR_DOOR_SIZE = 2 * 11
                     0018   258 SPR_DJUMP_SIZE = 4 * 6
                     0010   259 SPR_GPUP_SIZE = 2 * 8
                            260 
                            261 
                            262 
                            263 
                            264 
                            265 ;PLAYER ANIMATIONS
                            266 .globl anim_player_idle_R
                            267 .globl anim_player_idle_L
                            268 .globl anim_player_run_R
                            269 .globl anim_player_run_L
                            270 .globl anim_player_wall_R
                            271 .globl anim_player_wall_L
                            272 .globl anim_player_jump_R
                            273 .globl anim_player_jump_L
                            274 .globl anim_player_door
                            275 .globl anim_player_2_door
                            276 .globl anim_player_death
                            277 .globl anim_player_2_death
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 10.
Hexadecimal [16-Bits]



                            278 .globl anim_player_respawn
                            279 .globl anim_player_2_respawn
                            280 
                            281 
                            282 ;ENEMY ANIMATIONS
                            283 .globl anim_enemy_R
                            284 .globl anim_enemy_L
                            285 .globl anim_enemy_S
                            286 
                            287 
                            288 ;INTERACTABLE ANIMATIONS
                            289 .globl anim_interactable_door
                            290 .globl anim_interactable_gravity_up_power_up
                            291 .globl anim_interactable_gravity_down_power_up
                            292 .globl anim_interactable_djump_power_up
                            293 .globl anim_interactable_djump_active_power_up
                            294 .globl anim_interactable_colectable
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 11.
Hexadecimal [16-Bits]



                              2 
                              3 
                              4 ;;GLOBLS
                              5 
                              6 .globl cpct_disableFirmware_asm
                              7 .globl cpct_zx7b_decrunch_s_asm
                              8 .globl cpct_scanKeyboard_asm
                              9 .globl cpct_isAnyKeyPressed_f_asm
                             10 .globl cpct_isKeyPressed_asm
                             11 
                             12 
                             13 .globl cpct_drawSprite_asm
                             14 .globl cpct_drawSpriteVFlip_asm
                             15 .globl cpct_drawSpriteMasked_asm
                             16 .globl cpct_drawSpriteVFlipMasked_asm
                             17 .globl cpct_drawTileZigZagGrayCode4x8_af_asm
                             18 .globl cpct_drawSolidBox_asm
                             19 
                             20 
                             21 .globl cpct_setPalette_asm
                             22 .globl cpct_setVideoMode_asm
                             23 .globl cpct_setPALColour_asm
                             24 .globl cpct_getScreenPtr_asm
                             25 .globl cpct_waitVSYNC_asm
                             26 .globl cpct_setVideoMemoryPage_asm
                             27 
                             28 .globl cpct_etm_setDrawTilemap4x8_ag_asm
                             29 .globl cpct_etm_drawTilemap4x8_ag_asm
                             30 
                             31 .globl cpct_akp_musicInit_asm
                             32 .globl cpct_akp_musicPlay_asm
                             33 
                             34 .globl cpct_waitHalts_asm
                             35 
                             36 .globl _cpct_keyboardStatusBuffer
                             37 .globl _g_palette
                             38 .globl _ambient_sound
                             39 
                             40 
                             41 
                             42 ;;AMSTRAD CONSTS
                     0050    43 SCREEN_W = 80
                     00C8    44 SCREEN_H = 200
                             45 
                             46 ;;TILEMAP CONSTS
                             47 
                     0014    48 TILEMAP_W           = 20
                     0017    49 TILEMAP_H           = 23
                     0019    50 TILEMAP_MENU_H      = 25
                             51 
                     2A00    52 TILEMAP_START       = 0x2A00
                     01CC    53 TILEMAP_SIZE        = TILEMAP_W * TILEMAP_H
                     01F4    54 TILEMAP_MENU_SIZE   = TILEMAP_W * TILEMAP_MENU_H
                     2BF4    55 TILESET_START       = TILEMAP_START + TILEMAP_MENU_SIZE
                     0600    56 TILESET_SIZE        = 0X0600
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 12.
Hexadecimal [16-Bits]



                             57 
                     00A0    58 HUD_SIZE            = 80*2
                     C0A0    59 TILEMAP_VMEM_START  = 0xC000+HUD_SIZE
                             60 
                     0020    61 TILE_SIZE           = 4 * 8
                     0004    62 TILE_W              = 4
                     0008    63 TILE_H              = 8
                             64 
                             65 ;;GAME STATES
                     0001    66 GS_SINGLEPLAYER     = 1
                     0002    67 GS_MULTIPLAYER      = 2
                             68 
                             69 ;;ENTITY PHYSICS CONSTS
                     0000    70 _eph_x              = 0
                     0001    71 _eph_y              = 1
                     0002    72 _eph_w              = 2
                     0003    73 _eph_h              = 3
                     0004    74 _eph_vx             = 4
                     0005    75 _eph_vy             = 5
                     0006    76 _eph_offset         = 6
                     0007    77 _eph_attributes     = 7
                     0008    78 _eph_size           = 8
                             79 
                     0005    80 _ephf_orientation   = 5
                     0004    81 _ephf_ground        = 4
                     0003    82 _ephf_wall          = 3
                     0002    83 _ephf_h_ground      = 2
                             84 
                             85 ;;ENTITY DRAWABLE CONSTS
                     0008    86 _ed_spr_l          =  0 + _eph_size
                     0009    87 _ed_spr_h          =  1 + _eph_size
                     000A    88 _ed_spr_wi         =  2 + _eph_size
                     000B    89 _ed_spr_he         =  3 + _eph_size
                     000C    90 _ed_spr_size       =  4 + _eph_size
                     000D    91 _ed_pre_x          =  5 + _eph_size
                     000E    92 _ed_pre_y          =  6 + _eph_size
                     000F    93 _ed_pre_o          =  7 + _eph_size
                     0010    94 _ed_ox             =  8 + _eph_size
                     0011    95 _ed_oy             =  9 + _eph_size
                     0012    96 _ed_anim_ind_h     = 10 + _eph_size
                     0013    97 _ed_anim_ind_l     = 11 + _eph_size
                     0014    98 _ed_anim_pos       = 12 + _eph_size
                     0015    99 _ed_anim_dur       = 13 + _eph_size
                            100 
                            101 
                     0016   102 _ed_size        = 14 + _eph_size
                            103 
                     0007   104 _edf_mask       = 7
                     0006   105 _edf_flip       = 6
                            106 
                            107 ;;ENTITY INTERACTABLE CONSTS
                     0016   108 _ei_score       = 0 + _ed_size
                     0017   109 _ei_type        = 1 + _ed_size
                     0018   110 _ei_disabled    = 2 + _ed_size
                            111 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 13.
Hexadecimal [16-Bits]



                     0019   112 _ei_size        = 3 + _ed_size
                            113 
                     0000   114 _eit_w            = 0
                     0001   115 _eit_h            = 1
                     0002   116 _eit_attributes   = 2
                     0003   117 _eit_spr_l        = 3
                     0004   118 _eit_spr_h        = 4
                     0005   119 _eit_spr_wi       = 5
                     0006   120 _eit_spr_he       = 6
                     0007   121 _eit_spr_size     = 7
                     0008   122 _eit_spr_ox       = 8
                     0009   123 _eit_spr_oy       = 9
                     000A   124 _eit_anim_ind_h   = 10
                     000B   125 _eit_anim_ind_l   = 11
                     000C   126 _eit_score        = 12
                     000D   127 _eit_type         = 13
                            128 
                            129 ;;INTERACTABLE TYPES
                     0000   130 EI_NONE         = 0
                     0001   131 EI_CHECKPOINT   = 1
                     0002   132 EI_DOUBLE_JUMP  = 2
                     0003   133 EI_GRAVITY_UP   = 3
                     0004   134 EI_GRAVITY_DOWN = 4
                     0005   135 EI_COLLECTABLE  = 5
                     0006   136 EI_DOOR         = 6
                            137 
                            138 ;;ENTITY ENEMY CONSTS
                     0016   139 _ee_jump_state = 0 + _ed_size ;;Offset de la tabla de saltos
                     0017   140 _ee_type       = 1 + _ed_size
                     0018   141 _ee_disabled   = 2 + _ed_size
                     0019   142 _ee_origin_x   = 3 + _ed_size
                     001A   143 _ee_origin_y   = 4 + _ed_size
                     001B   144 _ee_size       = 5 + _ed_size
                            145 
                     0001   146 _eef_gravity        = 1
                            147 
                            148 ;; ENEMY TYPE CONSTS
                     0000   149 _eet_w            = 0
                     0001   150 _eet_h            = 1
                     0002   151 _eet_attributes   = 2
                     0003   152 _eet_spr_l        = 3
                     0004   153 _eet_spr_h        = 4
                     0005   154 _eet_spr_wi       = 5
                     0006   155 _eet_spr_he       = 6
                     0007   156 _eet_spr_size     = 7
                     0008   157 _eet_spr_ox       = 8
                     0009   158 _eet_spr_oy       = 9
                     000A   159 _eet_anim_ind_h   = 10
                     000B   160 _eet_anim_ind_l   = 11
                     000C   161 _eet_type         = 12
                            162 
                     0000   163 ET_NONE         = 0
                     0001   164 ET_TURTLE       = 1
                     0002   165 ET_SAW          = 2
                     0003   166 ET_ROCK         = 3
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 14.
Hexadecimal [16-Bits]



                            167 
                     0084   168 EE_DISABLED         = 132
                     0014   169 EE_SAW_DISABLED     = 20
                     0064   170 EE_ROCK_DISABLED    = 100
                            171 
                            172 ;;ENTITY PLAYER CONSTS
                     0016   173 _ep_jump_state      = 0 + _ed_size ;;Offset de la tabla de saltos
                     0017   174 _ep_wall_dir        = 1 + _ed_size ;;Indica si esta chocando con una pared y su orientacion
                     0018   175 _ep_force_x         = 2 + _ed_size ;;Force X
                     0019   176 _ep_score_cdm       = 3 + _ed_size ;;Score [Centenas de Millar, Decenas de Millar]
                     001A   177 _ep_score_mc        = 4 + _ed_size ;;Score [Millares, Centenas]
                     001B   178 _ep_score_du        = 5 + _ed_size ;;Score [Decenas, Unidades]
                     001C   179 _ep_deaths_mc       = 6 + _ed_size ;;Deaths [Millares, Centenas]
                     001D   180 _ep_deaths_du       = 7 + _ed_size ;;Deaths [Decenas, Unidades]
                     001E   181 _ep_player_attr     = 8 + _ed_size ;;Player Attributes
                     001F   182 _ep_anim_counter    = 9 + _ed_size ;;Contador para ciertas animaciones del jugador
                            183 
                     0020   184 _ep_size            = 10 + _ed_size
                            185 
                            186 ;;PLAYERS
                            187 .globl player_1
                            188 .globl player_2
                            189 
                            190 ;; ENEMIES
                            191 .globl enemy_index
                            192 .globl enemy_vector
                            193 .globl me_num_enemy
                            194 
                            195 ;; INTERACTUABLES
                            196 .globl interactable_index
                            197 .globl interactable_vector
                            198 .globl mi_num_interactable
                            199 .globl mi_next_interactable_l
                            200 
                            201 .globl checkpoint_x
                            202 .globl checkpoint_y
                            203 
                            204 ;;JUMP TABLE
                     0000   205 JT_INIT             = 0
                     0000   206 JT_WALL_JUMP        = 0
                     000E   207 JT_ON_GROUND        = 14
                     000F   208 JT_ON_WALL          = 15
                     0016   209 JT_END              = 22
                     0002   210 JT_PTOGRESSIVE_MIN  = 2
                     0008   211 JT_PROGRESSIVE_MAX  = 8
                     000B   212 JT_GRAVITY_CONTINUE = 11
                     0000   213 JT_GRAVITY_MARGIN   = 0
                            214 
                     007F   215 FORCE_X_R           = #0b01111111
                     0080   216 FORCE_X_L           = #0b10000000
                     007D   217 FORCE_X_R_MIN       = FORCE_X_R - 2
                     0083   218 FORCE_X_L_MIN       = FORCE_X_L + 3
                            219 
                            220 ;;SPRITE SIZES
                     0030   221 PLAYER = 48  ;; 0x30 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 15.
Hexadecimal [16-Bits]



                            222 
                            223 
                            224 ;;COLLISION CONSTS
                     0005   225 GROUP_TRANSPARENT   = 5
                     0026   226 GROUP_SOLID         = 38
                     002E   227 GROUP_DANGEROUS     = 46
                     002F   228 GROUP_GDOWN         = 47
                     0030   229 GROUP_GUP           = 48
                     0050   230 GROUP_ENTITIES      = 80
                            231 
                            232 ;;ENEMY CONSTS
                     0058   233 GROUP_SAW           = 88
                     005A   234 GROUP_ROCK          = 90
                     005C   235 GROUP_TURTLE        = 92
                     005C   236 GROUP_ENEMIES       = 92
                            237 
                            238 ;;INTERACTABLE CONSTS
                     0066   239 GROUP_INTERACTABLE  = 102
                            240 
                            241 
                            242 
                     0000   243 TRANSPARENT  = 0     ; Prioridad +
                     0001   244 GRAVITY_DOWN = 1     ; Prioridad ++
                     0002   245 GRAVITY_UP   = 2     ; Prioridad +++
                     0003   246 DANGEROUS    = 3     ; Prioridad ++++
                     0004   247 SOLID        = 4     ; Prioridad +++++
                            248 
                            249 
                            250 ;;SCORES
                     0064   251 PRIMERO = 100
                     004B   252 SEGUNDO = 75
                     0032   253 TERCERO = 50
                     0019   254 CUARTO  = 25
                            255 
                            256 
                            257 ;; DEFAULT KEYS
                            258 
                     0407   259 P1_KEY_R = #0x0407      ;;Default - 'E'
                     0807   260 P1_KEY_L = #0x0807      ;;Default - 'W'
                     0808   261 P1_KEY_J = #0x0808      ;;Default - 'Q'
                            262 
                     0803   263 P2_KEY_R = #0x0803      ;;Default - 'I'
                     0404   264 P2_KEY_L = #0x0404      ;;Default - 'O'
                     0804   265 P2_KEY_J = #0x0804      ;;Default - 'P'
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 16.
Hexadecimal [16-Bits]



                              2 
                              3 .globl mg_front_buffer
                              4 .globl mg_back_buffer
                              5 .globl mg_game_state
                              6 
                              7 .globl tries
                              8 
                              9 .globl _sr_draw_entity
                             10 .globl _sr_draw_entity_vector
                             11 .globl _sr_swap_buffers
                             12 .globl _sr_redraw_tiles
                             13 .globl _sr_redraw_tiles_fast
                             14 .globl _sr_redraw_vector
                             15 .globl _sr_decompress_image_on_video_memory
                             16 .globl _sr_manage_player_animations
                             17 .globl _sr_copy_back_to_front
                             18 .globl _sr_fill_backbuffer
                             19 .globl _sr_draw_HUD
                             20 .globl _sr_update_hud_player_data
                             21 .globl _sr_update_hud_skull
                             22 .globl _sr_draw_string
                             23 .globl _sr_draw_submenu_box
                             24 .globl _sr_draw_number_2d
                             25 
                             26 .globl _sr_apply_animation
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 17.
Hexadecimal [16-Bits]



                              2 
                              3 
                              4 .area _DATA
                              5 
   0000 00                    6 aux_01: .db #0x00
   0001 00                    7 aux_02: .db #0x00
                              8 
                              9 
                             10 
                             11 .area _CODE
                             12 
                             13 
                             14 
                             15 ;;==================================================================
                             16 ;;                         REDRAW TILES
                             17 ;;------------------------------------------------------------------
                             18 ;; Redibuja la parte del tilemap que está alrededor de la entidad
                             19 ;;------------------------------------------------------------------
                             20 ;;
                             21 ;; INPUT:
                             22 ;;  IY -> entity_drawable_ptr
                             23 ;;
                             24 ;; OUTPUT:
                             25 ;;  NONE
                             26 ;;
                             27 ;; DESTROYS:
                             28 ;;  AF, BC, DE, HL, BC', DE', HL'
                             29 ;;
                             30 ;;------------------------------------------------------------------
                             31 ;; CYCLES: [ | ]
                             32 ;;==================================================================
   0000                      33 _sr_redraw_tiles:
   0000 FD 4E 0D      [19]   34     ld c, _ed_pre_x(iy)
   0003 FD 46 0E      [19]   35     ld b, _ed_pre_y(iy)
                             36 
   0006 FD 7E 10      [19]   37     ld a, _ed_ox(iy)
   0009 81            [ 4]   38     add c
   000A 4F            [ 4]   39     ld c, a
                             40 
   000B FD 7E 11      [19]   41     ld a, _ed_oy(iy)
   000E 80            [ 4]   42     add b
   000F 47            [ 4]   43     ld b, a
                             44 
   0010                      45     rt_moved:
   0010 FD 6E 0A      [19]   46     ld l, _ed_spr_wi(iy)
   0013 FD 66 0B      [19]   47     ld h, _ed_spr_he(iy)
   0016 09            [11]   48     add hl, bc
   0017 EB            [ 4]   49     ex de, hl
                             50     ;;BC -> Esquina Superior Izquierda en 
                             51     ;;HL -> Esquina Inferior Derecha
                             52 
   0018 CB 38         [ 8]   53     srl b  
   001A CB 38         [ 8]   54     srl b
   001C CB 38         [ 8]   55     srl b
                             56 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 18.
Hexadecimal [16-Bits]



   001E 05            [ 4]   57     dec b   ;; El tilemap es tres tiles menor que la pantalla, por eso se le resta 3 a la Y
   001F 05            [ 4]   58     dec b
                             59 
   0020 CB 39         [ 8]   60     srl c
   0022 CB 39         [ 8]   61     srl c
                             62     
                             63 
   0024 CB 3A         [ 8]   64     srl d
   0026 CB 3A         [ 8]   65     srl d
   0028 CB 3A         [ 8]   66     srl d
                             67 
   002A 15            [ 4]   68     dec d   ;; El tilemap es tres tiles menor que la pantalla, por eso se le resta 3 a la Y
   002B 15            [ 4]   69     dec d
                             70 
   002C CB 3B         [ 8]   71     srl e
   002E CB 3B         [ 8]   72     srl e
                             73 
   0030 7A            [ 4]   74     ld a, d
   0031 90            [ 4]   75     sub b
   0032 57            [ 4]   76     ld d, a
                             77 
   0033 7B            [ 4]   78     ld a, e
   0034 91            [ 4]   79     sub c
   0035 5F            [ 4]   80     ld e, a 
                             81     
                             82     
                             83     ;BC ->  [Y, X]  Tile que corresponde con la esquina superior izquierda
                             84     ;DE -> [dY, dX] Diferencia en tiles de la esquina superior izquierda con la esquina inferior derecha
                             85     
   0036 C5            [11]   86     push bc
   0037 D5            [11]   87     push de
                             88     
   0038 04            [ 4]   89     inc b   ;; El tilemap es tres tiles menor que la pantalla, por eso se le resta 3 a la Y
   0039 04            [ 4]   90     inc b
                             91 
   003A CB 20         [ 8]   92     sla b   ;;obtenemos la posicion inicial del tile arriba a la izquierda
   003C CB 20         [ 8]   93     sla b
   003E CB 20         [ 8]   94     sla b
                             95 
                             96 
                             97 
   0040 CB 21         [ 8]   98     sla c
   0042 CB 21         [ 8]   99     sla c
                            100 
   0044 3A 00 00      [13]  101     ld a, (mg_back_buffer) 
   0047 57            [ 4]  102     ld d, a
   0048 1E 00         [ 7]  103     ld e, #0x00
   004A CD 00 00      [17]  104     call cpct_getScreenPtr_asm
                            105     ;;HL -> Puntero a memoria de video del tile que corresponde a la esquina superior izquierda de la entity_drawable
                            106     ;ld bc, #TILE_SIZE
                            107     ;ld de, #SCREEN_W
                            108 
   004D D9            [ 4]  109     exx
   004E D1            [10]  110     pop de
   004F C1            [10]  111     pop bc
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 19.
Hexadecimal [16-Bits]



                            112 
   0050 78            [ 4]  113     ld a, b
   0051 06 00         [ 7]  114     ld b, #0x00
                            115 
   0053 21 00 2A      [10]  116     ld hl, #TILEMAP_START
   0056 09            [11]  117     add hl, bc
   0057 01 14 00      [10]  118     ld bc, #TILEMAP_W
                            119 
   005A FE 00         [ 7]  120     cp #0x00
   005C 28 04         [12]  121     jr z, rt_loop_get_init_point_end
   005E                     122 rt_loop_get_init_point:
   005E 09            [11]  123         add hl, bc
   005F 3D            [ 4]  124         dec a
   0060 20 FC         [12]  125         jr nz, rt_loop_get_init_point
                            126 
   0062                     127 rt_loop_get_init_point_end:
                            128     ;HL  -> Puntero al tile que corresponde con la esquina superior izquierda
                            129     ;HL' -> Puntero a memoria de video del tile que corresponde a la esquina superior izquierda de la entity_drawable
                            130     ;DE  -> [dY, dX] Diferencia en tiles de la esquina superior izquierda con la esquina inferior derecha
   0062 7B            [ 4]  131     ld a, e
   0063 3C            [ 4]  132     inc a
   0064 32 00 00      [13]  133     ld (aux_01), a
                            134 
   0067 7A            [ 4]  135     ld a, d
   0068 3C            [ 4]  136     inc a
                            137 
   0069                     138 rt_loop_redraw_tile_rows:
   0069 F5            [11]  139         push af
   006A E5            [11]  140         push hl   ;;PUSH HL
   006B D9            [ 4]  141         exx
   006C E5            [11]  142         push hl   ;;PUSH HL'
   006D D9            [ 4]  143         exx
   006E 3A 00 00      [13]  144         ld a, (aux_01)
   0071                     145 rt_loop_redraw_tile_cols:
   0071 F5            [11]  146             push af
                            147 
   0072 7E            [ 7]  148             ld a, (hl)
   0073 E5            [11]  149             push hl
                            150 
   0074 21 F4 2B      [10]  151             ld hl, #TILESET_START
   0077 01 20 00      [10]  152             ld bc, #TILE_SIZE
   007A FE 00         [ 7]  153             cp #0x00
   007C 28 04         [12]  154             jr z, rt_loop_retdaw_get_tile_ptr_end
   007E                     155 rt_loop_retdaw_get_tile_ptr:
   007E 09            [11]  156                 add hl, bc
   007F 3D            [ 4]  157                 dec a
   0080 20 FC         [12]  158                 jr nz ,rt_loop_retdaw_get_tile_ptr
                            159 
   0082                     160 rt_loop_retdaw_get_tile_ptr_end:
                            161             ;HL -> sprite_ptr
   0082 D9            [ 4]  162             exx
   0083 54            [ 4]  163             ld d, h
   0084 5D            [ 4]  164             ld e, l
   0085 D5            [11]  165             push de
   0086 11 04 00      [10]  166             ld de, #TILE_W
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 20.
Hexadecimal [16-Bits]



   0089 19            [11]  167             add hl, de
   008A D9            [ 4]  168             exx
   008B D1            [10]  169             pop de
                            170             ;DE -> vmem_ptr
   008C CD 00 00      [17]  171             call cpct_drawTileZigZagGrayCode4x8_af_asm
                            172         
   008F E1            [10]  173             pop hl
   0090 23            [ 6]  174             inc hl
                            175 
   0091 F1            [10]  176             pop af
   0092 3D            [ 4]  177             dec a
   0093 20 DC         [12]  178             jr nz, rt_loop_redraw_tile_cols
                            179 
   0095 D9            [ 4]  180         exx
   0096 E1            [10]  181         pop hl
   0097 01 50 00      [10]  182         ld bc, #SCREEN_W
   009A 09            [11]  183         add hl, bc
   009B D9            [ 4]  184         exx
                            185 
   009C E1            [10]  186         pop hl
   009D 01 14 00      [10]  187         ld bc, #TILEMAP_W
   00A0 09            [11]  188         add hl, bc
                            189 
   00A1 F1            [10]  190         pop af
   00A2 3D            [ 4]  191         dec a
   00A3 20 C4         [12]  192         jr nz, rt_loop_redraw_tile_rows
   00A5 C9            [10]  193     ret
                            194 
                            195 
                            196 ;;==================================================================
                            197 ;;                         REDRAW VECTOR
                            198 ;;------------------------------------------------------------------
                            199 ;; Redibuja la parte del tilemap que está alrededor de cada entidad del vector de entidades
                            200 ;;------------------------------------------------------------------
                            201 ;;
                            202 ;; INPUT:
                            203 ;;  IY -> Inicio del vector de entidades
                            204 ;;  A  -> Número de elementos del vector
                            205 ;;  BC -> Tamaño de cada elemento del vector
                            206 ;;
                            207 ;; OUTPUT:
                            208 ;;  NONE
                            209 ;;
                            210 ;; DESTROYS:
                            211 ;;  AF, BC, DE, HL, BC', DE', HL'
                            212 ;;
                            213 ;;------------------------------------------------------------------
                            214 ;; CYCLES: [ | ]
                            215 ;;==================================================================
   00A6                     216 _sr_redraw_vector:
                            217 
   00A6 FE 00         [ 7]  218     cp #0x00
   00A8 C8            [11]  219     ret z
   00A9                     220     rv_loop_vector:
                            221     
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 21.
Hexadecimal [16-Bits]



   00A9 F5            [11]  222         push af
   00AA C5            [11]  223         push bc
                            224 
   00AB CD 7D 01      [17]  225         call _sr_redraw_tiles_fast
   00AE FD 46 00      [19]  226         ld b, _eph_x(iy)                ;;Establecemos la posicion actual a la pasada
   00B1 FD 70 0D      [19]  227         ld _ed_pre_x(iy), b
   00B4 FD 46 01      [19]  228         ld b, _eph_y(iy)
   00B7 FD 70 0E      [19]  229         ld _ed_pre_y(iy), b
   00BA FD 46 06      [19]  230         ld b, _eph_offset(iy)
   00BD FD 70 0F      [19]  231         ld _ed_pre_o(iy), b
                            232 
   00C0 C1            [10]  233         pop bc
   00C1 F1            [10]  234         pop af
   00C2 FD 09         [15]  235         add iy, bc
   00C4 3D            [ 4]  236         dec a
   00C5 20 E2         [12]  237         jr nz, rv_loop_vector
                            238 
   00C7 C9            [10]  239     ret
                            240 
                            241 
                            242 ;;==================================================================
                            243 ;;                         SWAP BUFFERS
                            244 ;;------------------------------------------------------------------
                            245 ;; Intercambia el backbuffer y el frontbuffer, y modifica el CRTC para que apunte al frontbuffer
                            246 ;;------------------------------------------------------------------
                            247 ;;
                            248 ;; INPUT:
                            249 ;;  NONE
                            250 ;;
                            251 ;; OUTPUT:
                            252 ;;  NONE
                            253 ;;
                            254 ;; DESTROYS:
                            255 ;;  AF, BC, HL
                            256 ;;
                            257 ;;------------------------------------------------------------------
                            258 ;; CYCLES: [ | ]
                            259 ;;==================================================================
   00C8                     260 _sr_swap_buffers:
   00C8 2A 00 00      [16]  261     ld hl, (mg_front_buffer)   ;; Inicialmente (80C0)
   00CB 7D            [ 4]  262     ld a, l                 ;; Carga el front buffer en el back buffer
   00CC 32 00 00      [13]  263     ld (mg_back_buffer) , a
   00CF 7C            [ 4]  264     ld a, h                 ;; Carga el back buffer en el front buffer
   00D0 32 00 00      [13]  265     ld (mg_front_buffer), a
                            266 
                            267 
   00D3 CB 3F         [ 8]  268     srl a
   00D5 CB 3F         [ 8]  269     srl a
   00D7 6F            [ 4]  270     ld l, a
                            271 
   00D8 C3 00 00      [10]  272     jp cpct_setVideoMemoryPage_asm
                            273 
                            274 
                            275 ;;==================================================================
                            276 ;;                         DRAW ENTITY    -    OPTIMIZARRRR
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 22.
Hexadecimal [16-Bits]



                            277 ;;------------------------------------------------------------------
                            278 ;; Dibuja una entidad a partir de un puntero a la misma.
                            279 ;;------------------------------------------------------------------
                            280 ;;
                            281 ;; INPUT:
                            282 ;;  IY -> Entity_drawable ptr
                            283 ;;
                            284 ;; OUTPUT:
                            285 ;;  NONE
                            286 ;;
                            287 ;; DESTROYS:
                            288 ;;  AF, BC, DE, HL, IX
                            289 ;;
                            290 ;;------------------------------------------------------------------
                            291 ;; CYCLES: [2361 | 12949]
                            292 ;;==================================================================
   00DB                     293 _sr_draw_entity:
                            294 
   00DB 3A 00 00      [13]  295     ld a, (mg_back_buffer)
   00DE 57            [ 4]  296     ld d, a
   00DF 1E 00         [ 7]  297     ld e, #0x00              ;;[10] Poner en un futuro el inicio del doble buffer
   00E1 FD 46 01      [19]  298     ld b, _eph_y(iy)            ;;[19]
   00E4 FD 7E 11      [19]  299     ld a, _ed_oy(iy)
   00E7 80            [ 4]  300     add b
   00E8 47            [ 4]  301     ld b, a
                            302 
   00E9 FD 4E 00      [19]  303     ld c, _eph_x(iy)            ;;[19] -> [48]
   00EC FD 7E 10      [19]  304     ld a, _ed_ox(iy)
   00EF 81            [ 4]  305     add c
   00F0 4F            [ 4]  306     ld c, a
                            307 
   00F1 FD CB 07 76   [20]  308     bit 6, _eph_attributes(iy)  ;;[20]
   00F5 28 06         [12]  309     jr z, sde_no_add_b          ;;[7 | 12]
   00F7 FD 7E 0B      [19]  310         ld a, _ed_spr_he(iy)    ;;[20]
   00FA 80            [ 4]  311         add b                   ;;[4]
   00FB 3D            [ 4]  312         dec a                   ;;[4]
   00FC 47            [ 4]  313         ld b, a                 ;;[4]  -> [27 | 64]
   00FD                     314 sde_no_add_b:                   
                            315 
   00FD CD 00 00      [17]  316     call cpct_getScreenPtr_asm  ;;[277]
   0100 EB            [ 4]  317     ex de, hl                   ;;[4]  -> [281]
                            318     
                            319     
   0101 FD 66 09      [19]  320     ld h, _ed_spr_h(iy)         ;;[19]
   0104 FD 6E 08      [19]  321     ld l, _ed_spr_l(iy)         ;;[19]
   0107 06 00         [ 7]  322     ld b, #0x00                 ;;[7]
   0109 FD 4E 0C      [19]  323     ld c, _ed_spr_size(iy)      ;;[19]
   010C FD 7E 06      [19]  324     ld a, _eph_offset(iy)       ;;[]
   010F FE 00         [ 7]  325     cp #0x00
   0111 28 04         [12]  326     jr z, sde_offset_continue
   0113                     327 sde_offset_loop:
   0113 09            [11]  328         add hl, bc
   0114 3D            [ 4]  329         dec a
   0115 20 FC         [12]  330         jr nz, sde_offset_loop
   0117                     331 sde_offset_continue:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 23.
Hexadecimal [16-Bits]



                            332 
   0117 FD 4E 0A      [19]  333     ld c, _ed_spr_wi(iy)        ;;[19]
   011A FD 46 0B      [19]  334     ld b, _ed_spr_he(iy)        ;;[19] -> [38]
                            335 
   011D FD 7E 07      [19]  336     ld a, _eph_attributes(iy)   ;;[19]
   0120 CB 7F         [ 8]  337     bit 7, a                    ;;[8]
   0122 20 0F         [12]  338     jr nz, sde_masqued          ;;[7 | 12]  -> [34 | 39]
                            339 
   0124 E6 40         [ 7]  340     and #0b01000000             ;;[7]
   0126 CA 00 00      [10]  341     jp z, cpct_drawSprite_asm   ;;[2046 | 5418] -> [2053 | 5425] -> [2556 | 5926]
                            342     
   0129 FD 7E 0A      [19]  343     ld   a, _ed_spr_wi(iy)      ;;[19]
   012C FD 46 0B      [19]  344     ld   b, _ed_spr_he(iy)      ;;[19]
   012F EB            [ 4]  345     ex de, hl                   ;;[4]
   0130 C3 00 00      [10]  346     jp cpct_drawSpriteVFlip_asm ;;[2234 | 6170] -> [2283 | 6219] -> [2823 | 6715]
                            347 
   0133                     348 sde_masqued:
                            349 
   0133 E6 40         [ 7]  350     and #0b01000000                     ;;[7]
   0135 CA 00 00      [10]  351     jp z, cpct_drawSpriteMasked_asm     ;;[1858 | 12434] -> [1865 | 12441] -> [2361 | 12949]
                            352     
   0138 FD 7E 0A      [19]  353     ld   a, _ed_spr_wi(iy)              ;;[19]
   013B FD 46 0B      [19]  354     ld   b, _ed_spr_he(iy)              ;;[19]
   013E 0E 00         [ 7]  355     ld   c, #0x00                       ;;[7]
   0140 DD 21 00 00   [14]  356     ld  ix, #0x0000                     ;;[14]
   0144 DD 09         [15]  357     add ix, bc                          ;;[15]
   0146 EB            [ 4]  358     ex de, hl                           ;;[4]
   0147 C3 00 00      [10]  359     jp cpct_drawSpriteVFlipMasked_asm   ;;[3686 | 12038] -> [3771 | 12123] -> [4316 | 12668]
                            360 
                            361 
                            362 
                            363 ;;==================================================================
                            364 ;;                       DRAW ENTITY VECTOR
                            365 ;;------------------------------------------------------------------
                            366 ;; Dibuja todas las entidades de un vector.
                            367 ;; PD: El contador del vector tiene que estar un byte antes del vector
                            368 ;;------------------------------------------------------------------
                            369 ;;
                            370 ;; INPUT:
                            371 ;;  IY  -> Puntero al principio del vector
                            372 ;;  A   -> Número de elementos del vector
                            373 ;;  BC  -> Tamaño de cada elemento del vector
                            374 ;;
                            375 ;; OUTPUT:
                            376 ;;  NONE
                            377 ;;
                            378 ;; DESTROYS:
                            379 ;;  AF, BC, DE, HL, IX, IY, AF'
                            380 ;;
                            381 ;;------------------------------------------------------------------
                            382 ;; CYCLES: [ | ]
                            383 ;;==================================================================
   014A                     384 _sr_draw_entity_vector:
                            385 
   014A FE 00         [ 7]  386     cp #00
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 24.
Hexadecimal [16-Bits]



   014C C8            [11]  387     ret z
   014D                     388     dev_vector_loop:
   014D 08            [ 4]  389         ex af, af'
   014E C5            [11]  390         push bc
                            391 
   014F FD 7E 18      [19]  392         ld a, _ee_disabled(iy)
   0152 FE 00         [ 7]  393         cp #0x00
   0154 20 1F         [12]  394         jr nz, dev_next_entity
                            395 
                            396             ;Comprobamos animaciones
   0156 FD 7E 12      [19]  397             ld a, _ed_anim_ind_h(iy) 
   0159 FE FE         [ 7]  398             cp #0xFE
   015B 20 07         [12]  399             jr nz, dev_yes_animation
                            400 
   015D FD 7E 13      [19]  401             ld a, _ed_anim_ind_l(iy)
   0160 FE FE         [ 7]  402             cp #0xFE
   0162 28 0C         [12]  403             jr z, dev_no_animation
                            404 
   0164                     405     dev_yes_animation:
   0164 FD 56 12      [19]  406             ld d, _ed_anim_ind_h(iy)
   0167 FD 5E 13      [19]  407             ld e, _ed_anim_ind_l(iy)
   016A 21 00 00      [10]  408             ld hl, #0x0000
   016D CD 20 02      [17]  409             call _sr_apply_animation
                            410 
   0170                     411     dev_no_animation:
   0170 CD DB 00      [17]  412             call _sr_draw_entity
   0173 18 00         [12]  413             jr dev_next_entity
                            414 
   0175                     415         dev_next_entity:
   0175 C1            [10]  416         pop bc
   0176 08            [ 4]  417         ex af, af'
                            418 
   0177 FD 09         [15]  419         add iy, bc
   0179 3D            [ 4]  420         dec a
   017A 20 D1         [12]  421         jr nz, dev_vector_loop
                            422 
   017C C9            [10]  423     ret
                            424 
                            425 
                            426 
                            427 ;;==================================================================
                            428 ;;                       REDRAW ENTITY FAST
                            429 ;;------------------------------------------------------------------
                            430 ;; Redibuja el fondo de los sprites con un cuadrado del color de fondo
                            431 ;;------------------------------------------------------------------
                            432 ;;
                            433 ;; INPUT:
                            434 ;;  IY  -> Puntero al entity_drawable
                            435 ;;
                            436 ;; OUTPUT:
                            437 ;;  NONE
                            438 ;;
                            439 ;; DESTROYS:
                            440 ;;  AF, BC, DE, HL
                            441 ;;
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 25.
Hexadecimal [16-Bits]



                            442 ;;------------------------------------------------------------------
                            443 ;; CYCLES: [ | ]
                            444 ;;==================================================================
   017D                     445 _sr_redraw_tiles_fast:
                            446 
   017D FD 4E 0D      [19]  447     ld c, _ed_pre_x(iy)
   0180 FD 46 0E      [19]  448     ld b, _ed_pre_y(iy)
                            449 
   0183 FD 7E 10      [19]  450     ld a, _ed_ox(iy)
   0186 81            [ 4]  451     add c
   0187 4F            [ 4]  452     ld c, a
                            453 
   0188 FD 7E 11      [19]  454     ld a, _ed_oy(iy)
   018B 80            [ 4]  455     add b
   018C 47            [ 4]  456     ld b, a
                            457 
   018D 3A 00 00      [13]  458     ld a, (mg_back_buffer)
   0190 57            [ 4]  459     ld d, a
   0191 1E 00         [ 7]  460     ld e, #0x00
   0193 CD 00 00      [17]  461     call cpct_getScreenPtr_asm
                            462 
   0196 EB            [ 4]  463     ex de, hl
                            464     
   0197 FD 46 0B      [19]  465     ld b, _ed_spr_he(iy)
   019A FD 4E 0A      [19]  466     ld c, _ed_spr_wi(iy)
   019D FD 7E 0F      [19]  467     ld a, _ed_pre_o(iy)
   01A0 FE 00         [ 7]  468     cp #0x00
   01A2 20 01         [12]  469     jr nz, rtf_draw_full_sprite
                            470       
   01A4 0D            [ 4]  471       dec c
                            472 
   01A5                     473 rtf_draw_full_sprite:
   01A5 3E F0         [ 7]  474     ld a, #0xF0
   01A7 CD 00 00      [17]  475     call cpct_drawSolidBox_asm
                            476 
   01AA C9            [10]  477     ret
                            478 
                            479 
                            480 ;;==================================================================
                            481 ;;                       MANAGE PLAYER ANIMATIONS
                            482 ;;------------------------------------------------------------------
                            483 ;; Controla la animacion de la entidad y la cambia de ser necesario
                            484 ;;------------------------------------------------------------------
                            485 ;;
                            486 ;; INPUT:
                            487 ;;  IY  -> Puntero al entity_drawable
                            488 ;;
                            489 ;; OUTPUT:
                            490 ;;  DE  -> Animacion que corresponderia al jugador 
                            491 ;;   A  -> 0 P2 se dibuja normal, 1-> P2 no incrementa al dibujar 
                            492 ;;
                            493 ;; DESTROYS:
                            494 ;;  AF, BC, DE, HL
                            495 ;;
                            496 ;;------------------------------------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 26.
Hexadecimal [16-Bits]



                            497 ;; CYCLES: [ | ]
                            498 ;;==================================================================
   01AB                     499 _sr_manage_player_animations:
                            500 
   01AB 11 00 00      [10]  501     ld de, #anim_player_door
   01AE 3E 01         [ 7]  502     ld a, #0x01
   01B0 FD CB 1E 6E   [20]  503     bit 5, _ep_player_attr(iy)
   01B4 C0            [11]  504     ret nz
                            505 
   01B5 11 00 00      [10]  506     ld de, #anim_player_death
   01B8 3E 02         [ 7]  507     ld a, #0x02
   01BA FD CB 1E 5E   [20]  508     bit 3, _ep_player_attr(iy)
   01BE C0            [11]  509     ret nz
                            510 
   01BF 11 00 00      [10]  511     ld de, #anim_player_respawn
   01C2 3E 03         [ 7]  512     ld a, #0x03
   01C4 FD CB 1E 56   [20]  513     bit 2, _ep_player_attr(iy)
   01C8 C0            [11]  514     ret nz
                            515     
                            516 
   01C9 FD CB 07 6E   [20]  517     bit 5, _eph_attributes(iy)              ;;Comprobamos Izquierda/Derecha
   01CD 20 28         [12]  518     jr nz, ma_right
                            519 
   01CF                     520 ma_left:                                    ;;----IZQUIERDA-----------------------------------------
   01CF FD CB 07 66   [20]  521         bit 4, _eph_attributes(iy)          ;;Comprobamos si esta en el suelo
   01D3 28 11         [12]  522         jr z, ma_left_no_ground
                            523 
   01D5 FD 7E 04      [19]  524             ld a, _eph_vx(iy)               ;;Comprobamos si se esta moviendo
   01D8 FE 00         [ 7]  525             cp #0x00
   01DA 20 05         [12]  526             jr nz, ma_left_ground_movement
                            527 
   01DC 11 00 00      [10]  528                 ld de, #anim_player_idle_L  ;;Cargamos la animacion de suelo sin moverse izquierda
   01DF AF            [ 4]  529                 xor a
   01E0 C9            [10]  530                 ret
                            531 
   01E1                     532 ma_left_ground_movement:
   01E1 11 00 00      [10]  533                 ld de, #anim_player_run_L  ;;Cargamos la animacion de suelo corriendo izquierda
   01E4 AF            [ 4]  534                 xor a                
   01E5 C9            [10]  535                 ret
                            536 
   01E6                     537 ma_left_no_ground:
                            538 
   01E6 FD 7E 17      [19]  539             ld a, _ep_wall_dir(iy)
   01E9 FE 00         [ 7]  540             cp #0x00
   01EB 20 05         [12]  541             jr nz, ma_left_no_ground_wall
                            542 
   01ED 11 00 00      [10]  543                 ld de, #anim_player_jump_L
   01F0 AF            [ 4]  544                 xor a
   01F1 C9            [10]  545                 ret
                            546 
   01F2                     547 ma_left_no_ground_wall:
                            548 
   01F2 11 00 00      [10]  549                 ld de, #anim_player_wall_L
   01F5 AF            [ 4]  550                 xor a                
   01F6 C9            [10]  551                 ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 27.
Hexadecimal [16-Bits]



                            552 
   01F7                     553 ma_right:                                   ;;----DERECHA-------------------------------------------
   01F7 FD CB 07 66   [20]  554         bit 4, _eph_attributes(iy)          ;;Comprobamos si esta en el suelo
   01FB 28 11         [12]  555         jr z, ma_right_no_ground
                            556 
   01FD FD 7E 04      [19]  557             ld a, _eph_vx(iy)               ;;Comprobamos si se esta moviendo
   0200 FE 00         [ 7]  558             cp #0x00
   0202 20 05         [12]  559             jr nz, ma_right_ground_movement
                            560 
   0204 11 00 00      [10]  561                 ld de, #anim_player_idle_R  ;;Cargamos la animacion de suelo sin moverse izquierda
   0207 AF            [ 4]  562                 xor a                
   0208 C9            [10]  563                 ret
                            564 
   0209                     565 ma_right_ground_movement:
                            566 
   0209 11 00 00      [10]  567                 ld de, #anim_player_run_R  ;;Cargamos la animacion de suelo corriendo izquierda
   020C AF            [ 4]  568                 xor a  
   020D C9            [10]  569                 ret
                            570 
   020E                     571 ma_right_no_ground:
                            572 
   020E FD 7E 17      [19]  573             ld a, _ep_wall_dir(iy)
   0211 FE 00         [ 7]  574             cp #0x00
   0213 20 05         [12]  575             jr nz, ma_right_no_ground_wall
                            576 
   0215 11 00 00      [10]  577                 ld de, #anim_player_jump_R
   0218 AF            [ 4]  578                 xor a  
   0219 C9            [10]  579                 ret
                            580 
   021A                     581 ma_right_no_ground_wall:
                            582 
   021A 11 00 00      [10]  583                 ld de, #anim_player_wall_R
   021D AF            [ 4]  584                 xor a  
   021E C9            [10]  585                 ret
                            586 
                            587 
   021F C9            [10]  588     ret
                            589 
                            590 
                            591 ;;==================================================================
                            592 ;;                       APPLY ANIMATIONS
                            593 ;;------------------------------------------------------------------
                            594 ;; Comprueba la animacion actual del jugador y la cambia o la actualiza
                            595 ;;------------------------------------------------------------------
                            596 ;;
                            597 ;; INPUT:
                            598 ;;  IY  -> Puntero al entity_drawable
                            599 ;;  DE  -> Animacion a la que se quiere actualizar
                            600 ;;  HL  -> Offset del puntero Sprite Respecto al puntero de la animacion
                            601 ;;
                            602 ;; OUTPUT:
                            603 ;;  A -> Si ha llegado al final de la animacion (0 NO, 1 Si)
                            604 ;;
                            605 ;; DESTROYS:
                            606 ;;  AF, BC, DE, HL
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 28.
Hexadecimal [16-Bits]



                            607 ;;
                            608 ;;------------------------------------------------------------------
                            609 ;; CYCLES: [ | ]
                            610 ;;==================================================================
   0220                     611 _sr_apply_animation:
                            612 
   0220 FD 7E 12      [19]  613     ld a, _ed_anim_ind_h(iy)        ;;Comprobamos si la animacion actual y la que pasan es la misma
   0223 AA            [ 4]  614     xor d
   0224 47            [ 4]  615     ld b, a
   0225 FD 7E 13      [19]  616     ld a, _ed_anim_ind_l(iy)
   0228 AB            [ 4]  617     xor e
   0229 B0            [ 4]  618     or b
   022A 28 12         [12]  619     jr z, aa_continue_animation
                            620 
   022C FD 72 12      [19]  621         ld _ed_anim_ind_h(iy), d
   022F FD 73 13      [19]  622         ld _ed_anim_ind_l(iy), e
   0232 0E FF         [ 7]  623         ld c, #0xFF
   0234 06 00         [ 7]  624         ld b, #0x00
   0236 FD 71 14      [19]  625         ld _ed_anim_pos(iy), c
   0239 FD 70 15      [19]  626         ld _ed_anim_dur(iy), b
   023C 18 06         [12]  627         jr aa_continue_animation_no_load
                            628 
   023E                     629 aa_continue_animation:
                            630 
   023E FD 4E 14      [19]  631     ld c, _ed_anim_pos(iy)
   0241 FD 46 15      [19]  632     ld b, _ed_anim_dur(iy)
                            633 
   0244                     634 aa_continue_animation_no_load:
                            635     ;;DE -> animacion
                            636     ;;C  -> anim_pos
                            637     ;;B  -> anim_dur
                            638 
   0244 78            [ 4]  639     ld a, b
   0245 FE 00         [ 7]  640     cp #0x00
   0247 28 06         [12]  641     jr z, aa_change_animation_sprite 
                            642 
   0249 3D            [ 4]  643         dec a
   024A FD 77 15      [19]  644         ld _ed_anim_dur(iy), a
   024D AF            [ 4]  645         xor a
   024E C9            [10]  646         ret
                            647 
   024F                     648 aa_change_animation_sprite:
                            649 
   024F 0C            [ 4]  650         inc c
   0250 E5            [11]  651         push hl
   0251 C5            [11]  652         push bc
   0252 CB 21         [ 8]  653         sla c
   0254 CB 21         [ 8]  654         sla c
   0256 06 00         [ 7]  655         ld b, #0x00
                            656 
                            657 
   0258 62            [ 4]  658         ld h, d
   0259 6B            [ 4]  659         ld l, e
   025A 09            [11]  660         add hl, bc
   025B C1            [10]  661         pop bc
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 29.
Hexadecimal [16-Bits]



   025C 23            [ 6]  662         inc hl
   025D 7E            [ 7]  663         ld a, (hl)
   025E 2B            [ 6]  664         dec hl
   025F FE FE         [ 7]  665         cp #0xFE
   0261 28 29         [12]  666         jr z, aa_change_animation_sprite_infinite
   0263 FE FD         [ 7]  667         cp #0xFD
   0265 20 08         [12]  668         jr nz, aa_check_end_animation 
                            669 
   0267 01 EC FF      [10]  670             ld bc, #-20
   026A 09            [11]  671             add hl, bc
                            672 
   026B 0E 01         [ 7]  673             ld c, #0x01
                            674 
   026D 18 07         [12]  675             jr aa_change_animation_sprite_continue
                            676 
   026F                     677 aa_check_end_animation:
   026F FE FF         [ 7]  678         cp #0xFF
   0271 20 03         [12]  679         jr nz, aa_change_animation_sprite_continue
                            680 
   0273 EB            [ 4]  681             ex de, hl
   0274 0E 00         [ 7]  682             ld c, #0x00
                            683 
   0276                     684 aa_change_animation_sprite_continue:
                            685         ;;C  -> Posicion
   0276 5E            [ 7]  686         ld e, (hl)  ;;DE -> Sprite
   0277 23            [ 6]  687         inc hl
   0278 56            [ 7]  688         ld d, (hl)
   0279 23            [ 6]  689         inc hl
   027A 46            [ 7]  690         ld b, (hl)  ;;B  -> Duracion 
                            691 
   027B E1            [10]  692         pop hl
   027C 19            [11]  693         add hl, de
   027D EB            [ 4]  694         ex de, hl
                            695 
   027E FD 73 08      [19]  696         ld _ed_spr_l(iy), e
   0281 FD 72 09      [19]  697         ld _ed_spr_h(iy), d
   0284 FD 71 14      [19]  698         ld _ed_anim_pos(iy), c
   0287 FD 70 15      [19]  699         ld _ed_anim_dur(iy), b
   028A AF            [ 4]  700         xor a
                            701 
   028B C9            [10]  702     ret
                            703 
   028C                     704 aa_change_animation_sprite_infinite:
   028C E1            [10]  705     pop hl
   028D FD 36 15 FF   [19]  706     ld _ed_anim_dur(iy), #0xFF
   0291 3E 01         [ 7]  707     ld a, #0x01
   0293 C9            [10]  708     ret
                            709 
                            710 
                            711 
                            712 
                            713 
                            714 
                            715 ;;==================================================================
                            716 ;;                DECOMPRESS IMAGE ON VIDEO MEMORY
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 30.
Hexadecimal [16-Bits]



                            717 ;;------------------------------------------------------------------
                            718 ;; Descomprime una imagen que ocupa toda la pantalla en memoria de
                            719 ;; video
                            720 ;;------------------------------------------------------------------
                            721 ;;
                            722 ;; INPUT:
                            723 ;;  DE  -> Puntero al final de la imagen comprimida
                            724 ;;
                            725 ;; OUTPUT:
                            726 ;;  NONE
                            727 ;;
                            728 ;; DESTROYS:
                            729 ;;  AF, BC, DE, HL
                            730 ;;
                            731 ;;------------------------------------------------------------------
                            732 ;; CYCLES: [ | ]
                            733 ;;==================================================================
   0294                     734 _sr_decompress_image_on_video_memory:
                            735 
   0294 3A 00 00      [13]  736     ld a, (#mg_front_buffer)
   0297 67            [ 4]  737     ld h, a
   0298 2E 00         [ 7]  738     ld l, #0x00
   029A 01 FF 3F      [10]  739     ld bc, #0x4000 - 1
   029D 09            [11]  740     add hl, bc
   029E EB            [ 4]  741     ex de, hl
   029F C3 00 00      [10]  742     jp cpct_zx7b_decrunch_s_asm
                            743 
                            744 
                            745 
                            746 ;;==================================================================
                            747 ;;                COPY BACKBUFFER TO FRONTBUFFER
                            748 ;;------------------------------------------------------------------
                            749 ;; Copia el backbuffer en el frontbuffer
                            750 ;;------------------------------------------------------------------
                            751 ;;
                            752 ;; INPUT:
                            753 ;;  NONE
                            754 ;;
                            755 ;; OUTPUT:
                            756 ;;  NONE
                            757 ;;
                            758 ;; DESTROYS:
                            759 ;;  AF, BC, DE, HL
                            760 ;;
                            761 ;;------------------------------------------------------------------
                            762 ;; CYCLES: [ | ]
                            763 ;;==================================================================
   02A2                     764 _sr_copy_back_to_front:
   02A2 3A 00 00      [13]  765     ld a, (mg_back_buffer)
   02A5 67            [ 4]  766     ld h, a
   02A6 2E 00         [ 7]  767     ld l, #0x00
   02A8 3A 00 00      [13]  768     ld a, (mg_front_buffer)
   02AB 57            [ 4]  769     ld d, a
   02AC 1E 00         [ 7]  770     ld e, #0x00
   02AE 01 00 40      [10]  771     ld bc, #0x4000
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 31.
Hexadecimal [16-Bits]



   02B1 ED B0         [21]  772     ldir
                            773 
   02B3 C9            [10]  774     ret
                            775 
                            776 
                            777 
                            778 
                            779 ;;==================================================================
                            780 ;;                      FILL BACKBUFFER
                            781 ;;------------------------------------------------------------------
                            782 ;; Copia el backbuffer en el frontbuffer
                            783 ;;------------------------------------------------------------------
                            784 ;;
                            785 ;; INPUT:
                            786 ;;  B -> Color de la pantalla
                            787 ;;
                            788 ;; OUTPUT:
                            789 ;;  NONE
                            790 ;;
                            791 ;; DESTROYS:
                            792 ;;  AF, BC, DE, HL
                            793 ;;
                            794 ;;------------------------------------------------------------------
                            795 ;; CYCLES: [ | ]
                            796 ;;==================================================================
   02B4                     797 _sr_fill_backbuffer:
   02B4 3A 00 00      [13]  798     ld a, (mg_back_buffer)
   02B7 67            [ 4]  799     ld h, a
   02B8 2E 00         [ 7]  800     ld l, #0x00
   02BA 70            [ 7]  801     ld (hl), b
   02BB 54            [ 4]  802     ld d, h
   02BC 5D            [ 4]  803     ld e, l
   02BD 13            [ 6]  804     inc de
   02BE 01 FF 3F      [10]  805     ld bc, #0x4000 - 1
   02C1 ED B0         [21]  806     ldir
                            807 
   02C3 C9            [10]  808     ret
                            809 
                            810 
                            811 ;;==================================================================
                            812 ;;                           DRAW HUD
                            813 ;;------------------------------------------------------------------
                            814 ;; Dibuja el HUD
                            815 ;;------------------------------------------------------------------
                            816 ;;
                            817 ;; INPUT:
                            818 ;;  NONE
                            819 ;;
                            820 ;; OUTPUT:
                            821 ;;  NONE
                            822 ;;
                            823 ;; DESTROYS:
                            824 ;;  AF, BC, DE, HL
                            825 ;;
                            826 ;;------------------------------------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 32.
Hexadecimal [16-Bits]



                            827 ;; CYCLES: [ | ]
                            828 ;;==================================================================
   02C4                     829 _sr_draw_HUD:
                            830 
                            831 ;IZQUIERDA ------------------------------------------------------------
                            832 
                            833     
                            834 
                            835 ;Dibujamos la linea de separacion entre el juego y el HUD    
   02C4 3A 00 00      [13]  836     ld a, (mg_back_buffer)
   02C7 C6 38         [ 7]  837     add #0x38
   02C9 67            [ 4]  838     ld h, a
   02CA 06 50         [ 7]  839     ld b, #0x50
   02CC 68            [ 4]  840     ld l, b
   02CD 3E FF         [ 7]  841     ld a, #0xFF
   02CF                     842 dh_draw_hud_line_loop:
                            843 
   02CF 77            [ 7]  844         ld (hl), a
   02D0 23            [ 6]  845         inc hl
                            846 
   02D1 05            [ 4]  847     dec b
   02D2 20 FB         [12]  848     jr nz, dh_draw_hud_line_loop
                            849 
                            850 
                            851 ;Dibujamos los iconos de P1 y P2
                            852 
   02D4 3A 00 00      [13]  853     ld a, (mg_back_buffer)
   02D7 57            [ 4]  854     ld d, a
   02D8 1E 00         [ 7]  855     ld e, #0x00
   02DA 01 04 0F      [10]  856     ld bc, #0x0F04
   02DD 3E FF         [ 7]  857     ld a, #0xFF
                            858     
   02DF D5            [11]  859     push de
   02E0 CD 00 00      [17]  860     call cpct_drawSolidBox_asm      ;Dibujamos el fondo blanco
   02E3 D1            [10]  861     pop de
                            862 
   02E4 21 01 28      [10]  863     ld hl, #0x2801
   02E7 19            [11]  864     add hl, de
   02E8 11 00 00      [10]  865     ld de, #_hud_spr_12
   02EB EB            [ 4]  866     ex de, hl
   02EC 01 01 05      [10]  867     ld bc, #0x0501
   02EF D5            [11]  868     push de
   02F0 CD 00 00      [17]  869     call cpct_drawSprite_asm        ;Icono de P1 1
   02F3 D1            [10]  870     pop de
                            871 
   02F4 13            [ 6]  872     inc de
   02F5 21 00 00      [10]  873     ld hl, #_hud_spr_13
   02F8 01 01 05      [10]  874     ld bc, #0x0501
   02FB D5            [11]  875     push de
   02FC CD 00 00      [17]  876     call cpct_drawSprite_asm        ;Icono de P1 2
   02FF D1            [10]  877     pop de
                            878 
   0300 13            [ 6]  879     inc de
   0301 13            [ 6]  880     inc de
   0302 13            [ 6]  881     inc de
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 33.
Hexadecimal [16-Bits]



   0303 21 00 00      [10]  882     ld hl, #_hud_spr_10
   0306 01 01 05      [10]  883     ld bc, #0x0501
   0309 D5            [11]  884     push de
   030A CD 00 00      [17]  885     call cpct_drawSprite_asm        ;Icono Muertes 1
   030D D1            [10]  886     pop de
                            887 
   030E 13            [ 6]  888     inc de
   030F 21 00 00      [10]  889     ld hl, #_hud_spr_11
   0312 01 01 05      [10]  890     ld bc, #0x0501
   0315 D5            [11]  891     push de
   0316 CD 00 00      [17]  892     call cpct_drawSprite_asm        ;Icono Muertes 2
   0319 D1            [10]  893     pop de
                            894 
   031A 3E 06         [ 7]  895     ld a, #0x06
   031C 83            [ 4]  896     add e
   031D 5F            [ 4]  897     ld e, a
   031E 3E 10         [ 7]  898     ld a, #0x10
   0320 92            [ 4]  899     sub d
   0321 ED 44         [ 8]  900     neg
   0323 57            [ 4]  901     ld d, a
   0324 01 01 09      [10]  902     ld bc, #0x0901
   0327 3E F4         [ 7]  903     ld a, #0xF4
   0329 D5            [11]  904     push de
   032A CD 00 00      [17]  905     call cpct_drawSolidBox_asm      ;Separacion Muertes/Puntuacion 1
   032D D1            [10]  906     pop de
                            907 
                            908 
   032E 3E 08         [ 7]  909     ld a, #0x08
   0330 83            [ 4]  910     add e
   0331 5F            [ 4]  911     ld e, a
   0332 3E 10         [ 7]  912     ld a, #0x10
   0334 82            [ 4]  913     add d
   0335 57            [ 4]  914     ld d, a
   0336 21 00 00      [10]  915     ld hl, #_hud_spr_00
   0339 01 01 05      [10]  916     ld bc, #0x0501
   033C D5            [11]  917     push de
   033D CD 00 00      [17]  918     call cpct_drawSprite_asm        ;Ultimo digito de puntiacion 1
   0340 D1            [10]  919     pop de
                            920 
                            921 
                            922 
   0341 3E 0E         [ 7]  923     ld a,#0x0E
   0343 83            [ 4]  924     add e
   0344 5F            [ 4]  925     ld e, a
   0345 3A 00 00      [13]  926     ld a, (mg_back_buffer)
   0348 57            [ 4]  927     ld d, a
   0349 01 01 0F      [10]  928     ld bc, #0x0F01
   034C 3E F5         [ 7]  929     ld a, #0xF5
   034E D5            [11]  930     push de
   034F CD 00 00      [17]  931     call cpct_drawSolidBox_asm      ;Separacion Puntuacion/Calaveras 1
   0352 D1            [10]  932     pop  de
                            933 
   0353 3E 0B         [ 7]  934     ld a, #0x0B
   0355 83            [ 4]  935     add e
   0356 5F            [ 4]  936     ld e, a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 34.
Hexadecimal [16-Bits]



   0357 01 01 0F      [10]  937     ld bc, #0x0F01
   035A 3E FA         [ 7]  938     ld a, #0xFA
   035C D5            [11]  939     push de
   035D CD 00 00      [17]  940     call cpct_drawSolidBox_asm      ;Separacion Puntuacion/Calaveras 2
   0360 D1            [10]  941     pop  de
                            942 
                            943 
                            944 
   0361 3E 14         [ 7]  945     ld a, #0x14
   0363 83            [ 4]  946     add e
   0364 5F            [ 4]  947     ld e, a
   0365 3E 28         [ 7]  948     ld a, #0x28
   0367 82            [ 4]  949     add d
   0368 57            [ 4]  950     ld d, a
   0369 21 00 00      [10]  951     ld hl, #_hud_spr_00
   036C 01 01 05      [10]  952     ld bc, #0x0501
   036F D5            [11]  953     push de
   0370 CD 00 00      [17]  954     call cpct_drawSprite_asm        ;Ultimo digito de puntiacion 2
   0373 D1            [10]  955     pop de
                            956 
                            957 
   0374 13            [ 6]  958     inc de
   0375 13            [ 6]  959     inc de
   0376 3E 10         [ 7]  960     ld a, #0x10
   0378 92            [ 4]  961     sub d
   0379 ED 44         [ 8]  962     neg
   037B 57            [ 4]  963     ld d, a
   037C 01 01 09      [10]  964     ld bc, #0x0901
   037F 3E F4         [ 7]  965     ld a, #0xF4
   0381 D5            [11]  966     push de
   0382 CD 00 00      [17]  967     call cpct_drawSolidBox_asm      ;Separacion Muertes/Puntuacion 2
   0385 D1            [10]  968     pop  de
                            969 
   0386 13            [ 6]  970     inc de
   0387 13            [ 6]  971     inc de
   0388 3E 10         [ 7]  972     ld a, #0x10
   038A 82            [ 4]  973     add d
   038B 57            [ 4]  974     ld d, a
   038C 21 00 00      [10]  975     ld hl, #_hud_spr_10
   038F 01 01 05      [10]  976     ld bc, #0x0501
   0392 D5            [11]  977     push de
   0393 CD 00 00      [17]  978     call cpct_drawSprite_asm        ;Icono Muertes P2 1
   0396 D1            [10]  979     pop de
                            980 
   0397 13            [ 6]  981     inc de
   0398 21 00 00      [10]  982     ld hl, #_hud_spr_11
   039B 01 01 05      [10]  983     ld bc, #0x0501
   039E D5            [11]  984     push de
   039F CD 00 00      [17]  985     call cpct_drawSprite_asm        ;Icono Muertes P2 2
   03A2 D1            [10]  986     pop de
                            987 
   03A3 3E 06         [ 7]  988     ld a, #0x06
   03A5 83            [ 4]  989     add e
   03A6 5F            [ 4]  990     ld e, a
   03A7 3A 00 00      [13]  991     ld a, (mg_back_buffer)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 35.
Hexadecimal [16-Bits]



   03AA 57            [ 4]  992     ld d, a
   03AB 01 04 0F      [10]  993     ld bc, #0x0F04
   03AE 3E FF         [ 7]  994     ld a, #0xFF
   03B0 D5            [11]  995     push de
   03B1 CD 00 00      [17]  996     call cpct_drawSolidBox_asm      ;Dibujamos el fondo blanco 2
   03B4 D1            [10]  997     pop  de
                            998 
   03B5 13            [ 6]  999     inc de
   03B6 3E 28         [ 7] 1000     ld a, #0x28
   03B8 82            [ 4] 1001     add d
   03B9 57            [ 4] 1002     ld d, a
   03BA 21 00 00      [10] 1003     ld hl, #_hud_spr_14
   03BD 01 01 05      [10] 1004     ld bc, #0x0501
   03C0 D5            [11] 1005     push de
   03C1 CD 00 00      [17] 1006     call cpct_drawSprite_asm        ;Icono P2 1 
   03C4 D1            [10] 1007     pop de
                           1008 
   03C5 13            [ 6] 1009     inc de
   03C6 21 00 00      [10] 1010     ld hl, #_hud_spr_15
   03C9 01 01 05      [10] 1011     ld bc, #0x0501
   03CC D5            [11] 1012     push de
   03CD CD 00 00      [17] 1013     call cpct_drawSprite_asm        ;Icono P2 2
   03D0 D1            [10] 1014     pop de
                           1015 
                           1016     
                           1017 
   03D1 CD 29 04      [17] 1018     call _sr_update_hud_skull 
                           1019 
   03D4 FD 21 00 00   [14] 1020     ld iy, #player_1
   03D8 3E 00         [ 7] 1021     ld a, #0x00
   03DA CD B5 04      [17] 1022     call _sr_update_hud_player_data
   03DD 3E 01         [ 7] 1023     ld a, #0x01
   03DF CD B5 04      [17] 1024     call _sr_update_hud_player_data
                           1025 
   03E2 3A 00 00      [13] 1026     ld a, (mg_game_state)
   03E5 FE 01         [ 7] 1027     cp #GS_SINGLEPLAYER 
   03E7 20 31         [12] 1028     jr nz, dh_draw_p2_data
                           1029 
   03E9 3A 00 00      [13] 1030         ld a, (mg_front_buffer)
   03EC 21 3B 28      [10] 1031         ld hl, #HUD_SCORE_POS
   03EF 11 00 00      [10] 1032         ld de, #em_no_p2_score
   03F2 CD 4D 05      [17] 1033         call _sr_draw_string
                           1034 
   03F5 3A 00 00      [13] 1035         ld a, (mg_back_buffer)
   03F8 21 3B 28      [10] 1036         ld hl, #HUD_SCORE_POS
   03FB 11 00 00      [10] 1037         ld de, #em_no_p2_score
   03FE CD 4D 05      [17] 1038         call _sr_draw_string
                           1039         
                           1040 
   0401 3A 00 00      [13] 1041         ld a, (mg_front_buffer)
   0404 21 47 28      [10] 1042         ld hl, #HUD_DEATH_POS
   0407 11 00 00      [10] 1043         ld de, #em_no_p2_deaths
   040A CD 4D 05      [17] 1044         call _sr_draw_string
                           1045 
   040D 3A 00 00      [13] 1046         ld a, (mg_back_buffer)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 36.
Hexadecimal [16-Bits]



   0410 21 47 28      [10] 1047         ld hl, #HUD_DEATH_POS
   0413 11 00 00      [10] 1048         ld de, #em_no_p2_deaths
   0416 CD 4D 05      [17] 1049         call _sr_draw_string
                           1050 
   0419 C9            [10] 1051         ret
                           1052 
                           1053 
   041A                    1054 dh_draw_p2_data:
                           1055 
   041A FD 21 00 00   [14] 1056     ld iy, #player_2
   041E 3E 00         [ 7] 1057     ld a, #0x00
   0420 CD B5 04      [17] 1058     call _sr_update_hud_player_data
   0423 3E 02         [ 7] 1059     ld a, #0x02
   0425 CD B5 04      [17] 1060     call _sr_update_hud_player_data
                           1061 
   0428 C9            [10] 1062     ret
                           1063 
                           1064 
                           1065 ;;==================================================================
                           1066 ;;                       UPDATE HUD SKULL
                           1067 ;;------------------------------------------------------------------
                           1068 ;; Dibuja el HUD
                           1069 ;;------------------------------------------------------------------
                           1070 ;;
                           1071 ;; INPUT:
                           1072 ;;  IY -> player_ptr
                           1073 ;;   A -> Info to update (0 -> muertes, 1 -> puntuacion)
                           1074 ;;
                           1075 ;; OUTPUT:
                           1076 ;;  NONE
                           1077 ;;
                           1078 ;; DESTROYS:
                           1079 ;;  AF, BC, DE, HL, AF'
                           1080 ;;
                           1081 ;;------------------------------------------------------------------
                           1082 ;; CYCLES: [ | ]
                           1083 ;;==================================================================
   0429                    1084 _sr_update_hud_skull:
                           1085 
   0429 3A 00 00      [13] 1086     ld a, (tries)
   042C 11 24 A0      [10] 1087     ld de, #HUD_SKULL_1 
                           1088     ;CALAVERA 1
   042F FE FF         [ 7] 1089     cp #0xFF
   0431 28 09         [12] 1090     jr z, uhs_skull_1_transparent
   0433 FE 04         [ 7] 1091     cp #0x04
   0435 28 05         [12] 1092     jr z, uhs_skull_1_transparent
                           1093 
   0437 21 00 00      [10] 1094         ld hl, #_hud_skull_spr_1
   043A 18 03         [12] 1095         jr uhs_skull_1_draw
                           1096 
   043C                    1097 uhs_skull_1_transparent:
                           1098 
   043C 21 00 00      [10] 1099         ld hl, #_hud_skull_spr_0
                           1100 
   043F                    1101 uhs_skull_1_draw:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 37.
Hexadecimal [16-Bits]



                           1102 
   043F 01 02 07      [10] 1103     ld bc, #0x0702
   0442 E5            [11] 1104     push hl
   0443 D5            [11] 1105     push de
   0444 CD 00 00      [17] 1106     call cpct_drawSprite_asm
   0447 D1            [10] 1107     pop de
   0448 E1            [10] 1108     pop hl
   0449 3E 40         [ 7] 1109     ld a, #0x40
   044B 82            [ 4] 1110     add d
   044C 57            [ 4] 1111     ld d, a
   044D 01 02 07      [10] 1112     ld bc, #0x0702
   0450 CD 00 00      [17] 1113     call cpct_drawSprite_asm
                           1114 
                           1115 
   0453 3A 00 00      [13] 1116     ld a, (tries)
   0456 11 27 A0      [10] 1117     ld de, #HUD_SKULL_2 
                           1118     ;CALAVERA 2
   0459 FE FF         [ 7] 1119     cp #0xFF
   045B 28 12         [12] 1120     jr z, uhs_skull_2_red
   045D FE 02         [ 7] 1121     cp #0x02
   045F 38 09         [12] 1122     jr c, uhs_skull_2_transparent
   0461 FE 04         [ 7] 1123     cp #0x04
   0463 28 05         [12] 1124     jr z, uhs_skull_2_transparent
                           1125 
   0465 21 00 00      [10] 1126         ld hl, #_hud_skull_spr_1
   0468 18 08         [12] 1127         jr uhs_skull_2_draw
                           1128 
   046A                    1129 uhs_skull_2_transparent:
                           1130 
   046A 21 00 00      [10] 1131         ld hl, #_hud_skull_spr_0
   046D 18 03         [12] 1132         jr uhs_skull_2_draw
                           1133 
   046F                    1134 uhs_skull_2_red:
                           1135 
   046F 21 00 00      [10] 1136         ld hl, #_hud_skull_spr_2
                           1137 
   0472                    1138 uhs_skull_2_draw:
                           1139 
   0472 01 02 07      [10] 1140     ld bc, #0x0702
   0475 E5            [11] 1141     push hl
   0476 D5            [11] 1142     push de
   0477 CD 00 00      [17] 1143     call cpct_drawSprite_asm
   047A D1            [10] 1144     pop de
   047B E1            [10] 1145     pop hl
   047C 3E 40         [ 7] 1146     ld a, #0x40
   047E 82            [ 4] 1147     add d
   047F 57            [ 4] 1148     ld d, a
   0480 01 02 07      [10] 1149     ld bc, #0x0702
   0483 CD 00 00      [17] 1150     call cpct_drawSprite_asm
                           1151 
   0486 3A 00 00      [13] 1152     ld a, (tries)
   0489 11 2A A0      [10] 1153     ld de, #HUD_SKULL_3
                           1154     ;CALAVERA 3
   048C FE FF         [ 7] 1155     cp #0xFF
   048E 28 0D         [12] 1156     jr z, uhs_skull_3_transparent
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 38.
Hexadecimal [16-Bits]



   0490 FE 04         [ 7] 1157     cp #0x04
   0492 28 09         [12] 1158     jr z, uhs_skull_3_transparent
   0494 FE 03         [ 7] 1159     cp #0x03
   0496 38 05         [12] 1160     jr c, uhs_skull_3_transparent
                           1161 
   0498 21 00 00      [10] 1162         ld hl, #_hud_skull_spr_1
   049B 18 03         [12] 1163         jr uhs_skull_3_draw
                           1164 
   049D                    1165 uhs_skull_3_transparent:
                           1166 
   049D 21 00 00      [10] 1167         ld hl, #_hud_skull_spr_0
                           1168 
   04A0                    1169 uhs_skull_3_draw:
                           1170 
   04A0 01 02 07      [10] 1171     ld bc, #0x0702
   04A3 E5            [11] 1172     push hl
   04A4 D5            [11] 1173     push de
   04A5 CD 00 00      [17] 1174     call cpct_drawSprite_asm
   04A8 D1            [10] 1175     pop de
   04A9 E1            [10] 1176     pop hl
   04AA 3E 40         [ 7] 1177     ld a, #0x40
   04AC 82            [ 4] 1178     add d
   04AD 57            [ 4] 1179     ld d, a
   04AE 01 02 07      [10] 1180     ld bc, #0x0702
   04B1 CD 00 00      [17] 1181     call cpct_drawSprite_asm
                           1182 
                           1183 
                           1184 
   04B4 C9            [10] 1185     ret
                           1186 
                           1187 
                           1188 
                           1189 ;;==================================================================
                           1190 ;;                       UPDATE HUD PLAYER DATA
                           1191 ;;------------------------------------------------------------------
                           1192 ;; Dibuja el HUD
                           1193 ;;------------------------------------------------------------------
                           1194 ;;
                           1195 ;; INPUT:
                           1196 ;;  IY -> player_ptr
                           1197 ;;   A -> Info to update (0 -> muertes, 1 -> puntuacion)
                           1198 ;;
                           1199 ;; OUTPUT:
                           1200 ;;  NONE
                           1201 ;;
                           1202 ;; DESTROYS:
                           1203 ;;  AF, BC, DE, HL, AF'
                           1204 ;;
                           1205 ;;------------------------------------------------------------------
                           1206 ;; CYCLES: [ | ]
                           1207 ;;==================================================================
   04B5                    1208 _sr_update_hud_player_data:
                           1209 
   04B5 08            [ 4] 1210     ex af, af'
   04B6 FD CB 1E 46   [20] 1211     bit 0, _ep_player_attr(iy)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 39.
Hexadecimal [16-Bits]



   04BA 28 08         [12] 1212     jr z, uhpd_player_1_data
                           1213 
   04BC 11 3B A8      [10] 1214         ld de, #HUD_P2_SCORE
   04BF 01 47 A8      [10] 1215         ld bc, #HUD_P2_DEATHS
   04C2 18 06         [12] 1216         jr uhpd_player_data_selected
                           1217 
   04C4                    1218 uhpd_player_1_data:
                           1219 
   04C4 11 0E A8      [10] 1220         ld de, #HUD_P1_SCORE
   04C7 01 07 A8      [10] 1221         ld bc, #HUD_P1_DEATHS
                           1222 
   04CA                    1223 uhpd_player_data_selected:
                           1224 
   04CA 08            [ 4] 1225     ex af, af'
   04CB FE 00         [ 7] 1226     cp #0x00
   04CD 28 28         [12] 1227     jr z, uhpd_update_deaths
                           1228 
   04CF                    1229 uhpd_update_score:
                           1230 
   04CF 3E 02         [ 7] 1231     ld a, #0x02
   04D1                    1232 uhpd_draw_score_loop:
   04D1 08            [ 4] 1233     ex af, af'
   04D2 D5            [11] 1234     push de
                           1235 
   04D3 FD 7E 19      [19] 1236         ld a, _ep_score_cdm(iy)
   04D6 D5            [11] 1237         push de
   04D7 CD 17 05      [17] 1238         call _sr_draw_number_2d
   04DA D1            [10] 1239         pop de
                           1240 
   04DB 13            [ 6] 1241         inc de
   04DC 13            [ 6] 1242         inc de
   04DD FD 7E 1A      [19] 1243         ld a, _ep_score_mc(iy)
   04E0 D5            [11] 1244         push de
   04E1 CD 17 05      [17] 1245         call _sr_draw_number_2d
   04E4 D1            [10] 1246         pop de
                           1247 
   04E5 13            [ 6] 1248         inc de
   04E6 13            [ 6] 1249         inc de
   04E7 FD 7E 1B      [19] 1250         ld a, _ep_score_du(iy)
   04EA CD 17 05      [17] 1251         call _sr_draw_number_2d
                           1252 
   04ED D1            [10] 1253     pop de
   04EE 3E 40         [ 7] 1254     ld a, #0x40
   04F0 82            [ 4] 1255     add d
   04F1 57            [ 4] 1256     ld d, a
                           1257         
   04F2 08            [ 4] 1258     ex af, af'
   04F3 3D            [ 4] 1259     dec a
   04F4 20 DB         [12] 1260     jr nz, uhpd_draw_score_loop
   04F6 C9            [10] 1261     ret
                           1262 
   04F7                    1263 uhpd_update_deaths:
                           1264 
   04F7 50            [ 4] 1265     ld d, b
   04F8 59            [ 4] 1266     ld e, c
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 40.
Hexadecimal [16-Bits]



                           1267 
   04F9 3E 02         [ 7] 1268     ld a, #0x02
                           1269 
   04FB                    1270 uhpd_draw_deaths_loop:
   04FB 08            [ 4] 1271     ex af, af'
   04FC D5            [11] 1272     push de
                           1273     
   04FD FD 7E 1C      [19] 1274         ld a, _ep_deaths_mc(iy)
   0500 D5            [11] 1275         push de
   0501 CD 17 05      [17] 1276         call _sr_draw_number_2d
   0504 D1            [10] 1277         pop de
                           1278 
   0505 13            [ 6] 1279         inc de
   0506 13            [ 6] 1280         inc de
   0507 FD 7E 1D      [19] 1281         ld a, _ep_deaths_du(iy)
   050A CD 17 05      [17] 1282         call _sr_draw_number_2d
                           1283     
   050D D1            [10] 1284     pop de
   050E 3E 40         [ 7] 1285     ld a, #0x40
   0510 82            [ 4] 1286     add d
   0511 57            [ 4] 1287     ld d, a
                           1288 
   0512 08            [ 4] 1289     ex af, af'
   0513 3D            [ 4] 1290     dec a
   0514 20 E5         [12] 1291     jr nz, uhpd_draw_deaths_loop
                           1292     
   0516 C9            [10] 1293     ret
                           1294 
                           1295 ;;==================================================================
                           1296 ;;                        DRAW NUMBER 2D
                           1297 ;;------------------------------------------------------------------
                           1298 ;; Dibuja dos digitos de un numero formateado con BCD
                           1299 ;;------------------------------------------------------------------
                           1300 ;;
                           1301 ;; INPUT:
                           1302 ;;  DE -> Vmem ptr
                           1303 ;;   A -> Numero a dibujar
                           1304 ;;
                           1305 ;; OUTPUT:
                           1306 ;;  NONE
                           1307 ;;
                           1308 ;; DESTROYS:
                           1309 ;;  AF, BC, DE, HL
                           1310 ;;
                           1311 ;;------------------------------------------------------------------
                           1312 ;; CYCLES: [ | ]
                           1313 ;;==================================================================
   0517                    1314 _sr_draw_number_2d:
                           1315 
                           1316     
   0517 F5            [11] 1317     push af
   0518 E6 F0         [ 7] 1318     and #0b11110000
   051A CB 3F         [ 8] 1319     srl a
   051C CB 3F         [ 8] 1320     srl a
   051E CB 3F         [ 8] 1321     srl a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 41.
Hexadecimal [16-Bits]



   0520 4F            [ 4] 1322     ld c, a
   0521 06 00         [ 7] 1323     ld b, #0x00
                           1324     ;;C -> Digito Izquierda * 2
   0523 21 00 00      [10] 1325     ld hl, #_hud_number_index
   0526 09            [11] 1326     add hl, bc
   0527 4E            [ 7] 1327     ld c, (hl)
   0528 23            [ 6] 1328     inc hl 
   0529 46            [ 7] 1329     ld b, (hl)
   052A 60            [ 4] 1330     ld h ,b
   052B 69            [ 4] 1331     ld l ,c
   052C 01 01 05      [10] 1332     ld bc, #0x0501
   052F D5            [11] 1333     push de
   0530 CD 00 00      [17] 1334     call cpct_drawSprite_asm
   0533 D1            [10] 1335     pop de
                           1336 
   0534 13            [ 6] 1337     inc de
   0535 F1            [10] 1338     pop af
   0536 E6 0F         [ 7] 1339     and #0b00001111
   0538 CB 27         [ 8] 1340     sla a
   053A 4F            [ 4] 1341     ld c, a
   053B 06 00         [ 7] 1342     ld b, #0x00
                           1343     ;;C -> Digito Derecha * 2
   053D 21 00 00      [10] 1344     ld hl, #_hud_number_index
   0540 09            [11] 1345     add hl, bc
   0541 4E            [ 7] 1346     ld c, (hl)
   0542 23            [ 6] 1347     inc hl 
   0543 46            [ 7] 1348     ld b, (hl)
   0544 60            [ 4] 1349     ld h ,b
   0545 69            [ 4] 1350     ld l ,c
   0546 01 01 05      [10] 1351     ld bc, #0x0501
   0549 CD 00 00      [17] 1352     call cpct_drawSprite_asm
                           1353     
   054C C9            [10] 1354     ret
                           1355 
                           1356 
                           1357 
                           1358 ;;==================================================================
                           1359 ;;                         DRAW STRING
                           1360 ;;------------------------------------------------------------------
                           1361 ;; Redibuja la parte del tilemap que está alrededor de la entidad
                           1362 ;;------------------------------------------------------------------
                           1363 ;;
                           1364 ;; INPUT:
                           1365 ;;   A -> Buffer donde dibujar
                           1366 ;;  HL -> Posicion relativa al Buffer
                           1367 ;;  DE -> Puntero al sprite
                           1368 ;;
                           1369 ;; OUTPUT:
                           1370 ;;  NONE
                           1371 ;;
                           1372 ;; DESTROYS:
                           1373 ;;  AF, BC, DE, HL, BC', DE', HL'
                           1374 ;;
                           1375 ;;------------------------------------------------------------------
                           1376 ;; CYCLES: [ | ]
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 42.
Hexadecimal [16-Bits]



                           1377 ;;==================================================================
   054D                    1378 _sr_draw_string:
                           1379 
   054D 47            [ 4] 1380     ld b, a
   054E 0E 00         [ 7] 1381     ld c, #0x00
   0550 09            [11] 1382     add hl, bc
   0551 EB            [ 4] 1383     ex de, hl
                           1384 
   0552                    1385 _sr_draw_string_loop:
   0552 7E            [ 7] 1386     ld a, (hl)
   0553 FE 2F         [ 7] 1387     cp #END_STRING
   0555 C8            [11] 1388     ret z
                           1389     
   0556 E5            [11] 1390     push hl
   0557 FE 3D         [ 7] 1391     cp #START_CHARACTERS
   0559 38 07         [12] 1392     jr c, ds_draw_number
   055B                    1393 ds_draw_character:
                           1394 
   055B D6 3D         [ 7] 1395         sub #START_CHARACTERS
   055D 21 00 00      [10] 1396         ld hl, #_hud_letter_index 
   0560 18 05         [12] 1397         jr ds_continue_draw
                           1398 
   0562                    1399 ds_draw_number:
                           1400 
   0562 D6 30         [ 7] 1401         sub #START_NUMBERS
   0564 21 00 00      [10] 1402         ld hl, #_hud_number_index
                           1403 
   0567                    1404 ds_continue_draw:
                           1405 
   0567 CB 27         [ 8] 1406     sla a
   0569 06 00         [ 7] 1407     ld b, #0x00
   056B 4F            [ 4] 1408     ld c, a
   056C 09            [11] 1409     add hl, bc
   056D 4E            [ 7] 1410     ld c, (hl)
   056E 23            [ 6] 1411     inc hl
   056F 46            [ 7] 1412     ld b, (hl)
   0570 60            [ 4] 1413     ld h, b
   0571 69            [ 4] 1414     ld l, c
                           1415 
   0572 01 01 05      [10] 1416     ld bc, #0x0501
                           1417 
                           1418     ;HL -> Puntero al sprite
                           1419     ;DE -> Puntero a Vmem
                           1420     ;BC -> Tamano del sprite
                           1421 
   0575 D5            [11] 1422     push de
   0576 CD 00 00      [17] 1423     call cpct_drawSprite_asm
   0579 D1            [10] 1424     pop de
   057A 13            [ 6] 1425     inc de
                           1426 
   057B E1            [10] 1427     pop hl
   057C 23            [ 6] 1428     inc hl
   057D 18 D3         [12] 1429     jr _sr_draw_string_loop
                           1430 
                           1431 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 43.
Hexadecimal [16-Bits]



                           1432 
                           1433 ;;==================================================================
                           1434 ;;                         DRAW SUBMENU BOX
                           1435 ;;------------------------------------------------------------------
                           1436 ;; Redibuja la parte del tilemap que está alrededor de la entidad
                           1437 ;;------------------------------------------------------------------
                           1438 ;;
                           1439 ;; INPUT:
                           1440 ;;  A  -> Buffer donde se va a dibujar
                           1441 ;;
                           1442 ;; OUTPUT:
                           1443 ;;  NONE
                           1444 ;;
                           1445 ;; DESTROYS:
                           1446 ;;  AF, BC, DE, HL, BC', DE', HL'
                           1447 ;;
                           1448 ;;------------------------------------------------------------------
                           1449 ;; CYCLES: [ | ]
                           1450 ;;==================================================================
   057F                    1451 _sr_draw_submenu_box:
                           1452 
   057F 47            [ 4] 1453     ld b, a
   0580 0E 00         [ 7] 1454     ld c, #0x00
                           1455 
   0582 C5            [11] 1456     push bc
                           1457 
   0583 21 20 03      [10] 1458     ld hl, #SUBMENU_BOX_1_POS
   0586 09            [11] 1459     add hl, bc
   0587 EB            [ 4] 1460     ex de, hl
   0588 01 40 28      [10] 1461     ld bc, #0x2840
   058B 3E F0         [ 7] 1462     ld a, #0xF0
   058D CD 00 00      [17] 1463     call cpct_drawSolidBox_asm
                           1464 
   0590 C1            [10] 1465     pop bc
   0591 C5            [11] 1466     push bc
                           1467 
   0592 21 60 03      [10] 1468     ld hl, #SUBMENU_BOX_2_POS
   0595 09            [11] 1469     add hl, bc
   0596 EB            [ 4] 1470     ex de, hl
   0597 01 10 28      [10] 1471     ld bc, #0x2810
   059A 3E F0         [ 7] 1472     ld a, #0xF0
   059C CD 00 00      [17] 1473     call cpct_drawSolidBox_asm
                           1474 
   059F C1            [10] 1475     pop bc
                           1476 
   05A0 21 20 1B      [10] 1477     ld hl, #SUBMENU_BOX_LINE_TOP
   05A3 09            [11] 1478     add hl, bc
   05A4 EB            [ 4] 1479     ex de, hl
                           1480 
   05A5 21 60 24      [10] 1481     ld hl, #SUBMENU_BOX_LINE_BOTTOM
   05A8 09            [11] 1482     add hl, bc
                           1483 
   05A9 0E 50         [ 7] 1484     ld c, #0x50
   05AB                    1485 dsb_draw_lines_loop:
                           1486 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 44.
Hexadecimal [16-Bits]



   05AB 3E FF         [ 7] 1487         ld a, #0xFF
   05AD 77            [ 7] 1488         ld (hl), a
   05AE 12            [ 7] 1489         ld (de), a
                           1490 
   05AF 13            [ 6] 1491         inc de
   05B0 23            [ 6] 1492         inc hl
                           1493 
   05B1 0D            [ 4] 1494         dec c
   05B2 20 F7         [12] 1495         jr nz, dsb_draw_lines_loop
                           1496 
   05B4 C9            [10] 1497     ret
                           1498 
                           1499 
